<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>地理信息地图服务</title>
    
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }
        
        /* 工具栏样式 */
        .toolbar {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 99;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .tool-button {
            background-color: #fff;
            border: 1px solid #d3d3d3;
            color: #6e6e6e;
            height: 32px;
            width: 32px;
            text-align: center;
            line-height: 32px;
            text-decoration: none;
            display: block;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tool-button:hover {
            background-color: #f0f0f0;
            color: #2e2e2e;
        }
        
        .tool-button.active {
            background-color: #0079c1;
            color: white;
        }
        
        /* 搜索框样式 */
        .search-container {
            position: absolute;
            top: 15px;
            left: 80px;
            z-index: 99;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            padding: 10px;
            display: flex;
            gap: 5px;
        }
        
        #search-input {
            width: 250px;
            padding: 8px;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #search-button {
            padding: 8px 15px;
            background-color: #0079c1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        #search-button:hover {
            background-color: #005a87;
        }
        
        /* 坐标显示样式 */
        .coordinates {
            position: absolute;
            bottom: 15px;
            left: 15px;
            z-index: 99;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* 测量结果样式 */
        .measurement-result {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 99;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            max-width: 250px;
        }
        
        /* 图层面板样式 */
        .layer-panel {
            position: absolute;
            top: 80px;
            right: 15px;
            z-index: 99;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            padding: 10px;
            width: 200px;
            display: none;
        }
        
        .layer-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .layer-item input {
            margin-right: 8px;
        }
        
        /* 加载动画 */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.29/"></script>
    
    <script>
        let map;
        let view;
        let measurementWidget;
        let searchWidget;
        let sketchWidget;
        let activeTool = null;
        let drawLayer;
        
        require([
            "esri/config",
            "esri/Map",
            "esri/views/MapView",
            "esri/widgets/BasemapToggle",
            "esri/widgets/BasemapGallery",
            "esri/widgets/Search",
            "esri/widgets/Measurement",
            "esri/widgets/ScaleBar",
            "esri/widgets/Compass",
            "esri/widgets/Locate",
            "esri/widgets/Sketch",
            "esri/layers/GraphicsLayer",
            "esri/Graphic",
            "esri/geometry/Point",
            "esri/geometry/Polyline",
            "esri/geometry/Polygon",
            "esri/symbols/SimpleMarkerSymbol",
            "esri/symbols/SimpleLineSymbol",
            "esri/symbols/SimpleFillSymbol",
            "esri/PopupTemplate",
            "esri/layers/FeatureLayer",
            "esri/widgets/LayerList",
            "esri/widgets/Print"
        ], function(
            esriConfig, Map, MapView, BasemapToggle, BasemapGallery, Search,
            Measurement, ScaleBar, Compass, Locate, Sketch, GraphicsLayer, Graphic,
            Point, Polyline, Polygon, SimpleMarkerSymbol, SimpleLineSymbol, SimpleFillSymbol,
            PopupTemplate, FeatureLayer, LayerList, Print
        ) {
            
            // 设置API密钥
            esriConfig.apiKey = "AAPK6cd235d068504d1ab46c7acc14a812b3sqFFVZ4Z62jzCOKKwV4KPPmcqlIEqzdTIRaTpZylvZ6ENDOKrdgDKtAi6OT6TTZZ";
            
            // 创建地图
            map = new Map({
                basemap: "streets-navigation-vector"
            });
            
            // 创建地图视图
            view = new MapView({
                map: map,
                center: [103.8343, 36.0611], // 兰州市中心坐标
                zoom: 12,
                container: "viewDiv"
            });
            
            // 创建图形图层用于测量和绘图
            const graphicsLayer = new GraphicsLayer();
            map.add(graphicsLayer);
            
            // 创建绘图图层
            drawLayer = new GraphicsLayer();
            map.add(drawLayer);
            
            // 等待视图加载完成后添加控件
            view.when(function() {
                // 添加底图切换控件
                const basemapToggle = new BasemapToggle({
                    view: view,
                    nextBasemap: "satellite"
                });
                view.ui.add(basemapToggle, "bottom-right");
                
                // 添加比例尺
                const scaleBar = new ScaleBar({
                    view: view,
                    unit: "metric"
                });
                view.ui.add(scaleBar, "bottom-left");
                
                // 添加指南针
                const compass = new Compass({
                    view: view
                });
                view.ui.add(compass, "top-left");
                
                // 添加定位按钮
                const locateBtn = new Locate({
                    view: view
                });
                view.ui.add(locateBtn, "top-left");
                
                // 创建搜索控件但不添加到UI中，我们将使用自定义搜索
                searchWidget = new Search({
                    view: view
                });
                
                // 创建测量控件但不添加到UI中
                measurementWidget = new Measurement({
                    view: view,
                    activeTool: null
                });
                
                // 创建绘图控件但不添加到UI中
                sketchWidget = new Sketch({
                    layer: drawLayer,
                    view: view,
                    creationMode: "update" // 允许创建和更新图形
                });
                
                // 监听绘图完成事件
                sketchWidget.on("create", function(event) {
                    if (event.state === "complete") {
                        console.log("图形创建完成", event.graphic);
                        // 可以在这里添加自定义逻辑，如保存图形等
                    }
                });
                
                // 监听测量工具的变化
                measurementWidget.watch("activeTool", function(newValue) {
                    if (newValue) {
                        document.getElementById("measurement-result").style.display = "block";
                    } else if (!activeTool) {
                        document.getElementById("measurement-result").style.display = "none";
                    }
                });
                
                // 监听测量值的变化
                measurementWidget.watch("viewModel.state", function(newValue) {
                    if (newValue === "measured") {
                        const measurement = measurementWidget.viewModel.measurement;
                        if (measurement) {
                            let resultText = "";
                            if (measurement.unit) {
                                if (measurement.unit.includes("meter") || measurement.unit.includes("kilometer")) {
                                    resultText = `距离: ${measurement.toFixed(2)} ${measurement.unit}`;
                                } else if (measurement.unit.includes("square")) {
                                    resultText = `面积: ${measurement.toFixed(2)} ${measurement.unit}`;
                                }
                            }
                            document.getElementById("measurement-result").innerHTML = resultText;
                        }
                    }
                });
                
                // 监听鼠标移动显示坐标
                view.on("pointer-move", function(event) {
                    const point = view.toMap({x: event.x, y: event.y});
                    if (point) {
                        document.getElementById("coordinates").innerHTML =
                            `经度: ${point.longitude.toFixed(6)}<br>纬度: ${point.latitude.toFixed(6)}`;
                    }
                });
                
                // 监听地图点击事件，用于反向地理编码
                view.on("click", function(event) {
                    if (activeTool === "identify") {
                        identifyFeature(event);
                    }
                });
                
                // 隐藏加载动画
                document.getElementById("loading").style.display = "none";
                
            }).catch(function(error) {
                console.error("地图创建失败:", error);
                document.getElementById("loading").innerHTML = "<div>地图加载失败，请刷新页面重试</div>";
            });
            
            // 搜索功能
            window.searchLocation = function() {
                const searchText = document.getElementById("search-input").value;
                if (!searchText) {
                    alert("请输入搜索内容");
                    return;
                }
                
                searchWidget.search(searchText).then(function(response) {
                    if (response.results && response.results.length > 0) {
                        const result = response.results[0];
                        view.goTo(result.target);
                    } else {
                        alert("未找到相关位置");
                    }
                }).catch(function(error) {
                    console.error("搜索失败:", error);
                    alert("搜索失败，请重试");
                });
            };
            
            // 工具切换功能
            window.toggleTool = function(tool) {
                // 重置所有工具按钮状态
                document.querySelectorAll(".tool-button").forEach(btn => {
                    btn.classList.remove("active");
                });
                
                // 清除之前的测量结果
                if (measurementWidget) {
                    measurementWidget.clear();
                }
                
                // 如果点击的是当前激活的工具，则关闭工具
                if (activeTool === tool) {
                    activeTool = null;
                    return;
                }
                
                // 设置新工具为激活状态
                activeTool = tool;
                document.getElementById(tool + "-btn").classList.add("active");
                
                // 根据工具类型执行相应操作
                switch(tool) {
                    case "distance":
                        measurementWidget.activeTool = "distance";
                        document.getElementById("measurement-result").innerHTML = "点击地图开始测量距离";
                        document.getElementById("measurement-result").style.display = "block";
                        break;
                    case "area":
                        measurementWidget.activeTool = "area";
                        document.getElementById("measurement-result").innerHTML = "点击地图开始测量面积";
                        document.getElementById("measurement-result").style.display = "block";
                        break;
                    case "identify":
                        document.getElementById("measurement-result").innerHTML = "点击地图识别要素";
                        document.getElementById("measurement-result").style.display = "block";
                        break;
                    case "draw":
                        toggleDrawPanel();
                        break;
                    case "layers":
                        toggleLayerPanel();
                        break;
                    case "print":
                        printMap();
                        break;
                }
            };
            
            // 切换图层面板
            function toggleLayerPanel() {
                const panel = document.getElementById("layer-panel");
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            }
            
            // 要素识别功能
            function identifyFeature(event) {
                view.hitTest(event).then(function(response) {
                    if (response.results.length > 0) {
                        const graphic = response.results[0].graphic;
                        view.popup.open({
                            location: event.mapPoint,
                            features: [graphic]
                        });
                    } else {
                        // 如果没有点击到要素，进行反向地理编码
                        reverseGeocode(event.mapPoint);
                    }
                });
            }
            
            // 反向地理编码
            function reverseGeocode(point) {
                searchWidget.viewModel.locator.locationToAddress(point)
                    .then(function(response) {
                        if (response.address) {
                            view.popup.open({
                                location: point,
                                title: "地址信息",
                                content: response.address.LongLabel || response.address.ShortLabel
                            });
                        } else {
                            view.popup.open({
                                location: point,
                                title: "位置信息",
                                content: `经度: ${point.longitude.toFixed(6)}<br>纬度: ${point.latitude.toFixed(6)}`
                            });
                        }
                    })
                    .catch(function(error) {
                        console.error("反向地理编码失败:", error);
                        view.popup.open({
                            location: point,
                            title: "位置信息",
                            content: `经度: ${point.longitude.toFixed(6)}<br>纬度: ${point.latitude.toFixed(6)}`
                        });
                    });
            }
            
            // 切换绘图面板
            function toggleDrawPanel() {
                const panel = document.getElementById("draw-panel");
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                    sketchWidget.cancel();
                    // 如果面板是打开状态，则关闭工具
                    document.getElementById("draw-btn").classList.remove("active");
                    activeTool = null;
                } else {
                    panel.style.display = "block";
                }
            }
            
            // 开始绘图
            window.startDrawing = function(drawType) {
                // 隐藏图层面板（如果打开）
                document.getElementById("layer-panel").style.display = "none";
                
                // 设置绘图类型
                sketchWidget.create(drawType);
                
                // 更新按钮状态
                document.querySelectorAll(".tool-button").forEach(btn => {
                    btn.classList.remove("active");
                });
                document.getElementById("draw-btn").classList.add("active");
                
                // 显示提示信息
                document.getElementById("measurement-result").innerHTML = `正在绘制: ${getDrawTypeName(drawType)}`;
                document.getElementById("measurement-result").style.display = "block";
                
                // 隐藏绘图面板
                document.getElementById("draw-panel").style.display = "none";
            };
            
            // 获取绘图类型名称
            function getDrawTypeName(type) {
                const names = {
                    "point": "点",
                    "polyline": "线",
                    "polygon": "面",
                    "rectangle": "矩形",
                    "circle": "圆形",
                    "text": "文本"
                };
                return names[type] || type;
            }
            
            // 清除绘图
            window.clearDrawings = function() {
                drawLayer.removeAll();
                document.getElementById("measurement-result").innerHTML = "已清除所有绘图";
                setTimeout(() => {
                    if (!activeTool) {
                        document.getElementById("measurement-result").style.display = "none";
                    }
                }, 2000);
                
                // 重置绘图工具状态
                sketchWidget.cancel();
                document.getElementById("draw-btn").classList.remove("active");
                activeTool = null;
            };
            
            // 图层切换功能
            window.toggleLayer = function(layerType) {
                const checkbox = document.getElementById(layerType + "-layer");
                const isChecked = checkbox.checked;
                
                // 移除现有的图层
                switch(layerType) {
                    case "traffic":
                        if (isChecked) {
                            // 添加交通图层
                            map.basemap = "streets-navigation-vector";
                            showNotification("已添加交通图层");
                        } else {
                            // 恢复默认底图
                            map.basemap = "streets-vector";
                            showNotification("已移除交通图层");
                        }
                        break;
                    case "satellite":
                        if (isChecked) {
                            // 切换到卫星底图
                            map.basemap = "satellite";
                            showNotification("已切换到卫星图层");
                        } else {
                            // 恢复默认底图
                            map.basemap = "streets-vector";
                            showNotification("已移除卫星图层");
                        }
                        break;
                    case "terrain":
                        if (isChecked) {
                            // 切换到地形底图
                            map.basemap = "topo-vector";
                            showNotification("已切换到地形图层");
                        } else {
                            // 恢复默认底图
                            map.basemap = "streets-vector";
                            showNotification("已移除地形图层");
                        }
                        break;
                    case "population":
                        if (isChecked) {
                            // 添加人口密度图层
                            addPopulationLayer();
                            showNotification("已添加人口密度图层");
                        } else {
                            // 移除人口密度图层
                            removePopulationLayer();
                            showNotification("已移除人口密度图层");
                        }
                        break;
                    case "weather":
                        if (isChecked) {
                            // 添加天气图层
                            addWeatherLayer();
                            showNotification("已添加天气图层");
                        } else {
                            // 移除天气图层
                            removeWeatherLayer();
                            showNotification("已移除天气图层");
                        }
                        break;
                }
            };
            
            // 显示通知
            function showNotification(message) {
                const notification = document.createElement("div");
                notification.style.position = "absolute";
                notification.style.top = "50%";
                notification.style.left = "50%";
                notification.style.transform = "translate(-50%, -50%)";
                notification.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
                notification.style.color = "white";
                notification.style.padding = "10px 20px";
                notification.style.borderRadius = "4px";
                notification.style.zIndex = "1000";
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            }
            
            // 添加人口密度图层
            function addPopulationLayer() {
                const populationLayer = new FeatureLayer({
                    url: "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/World_Cities/FeatureServer/0",
                    renderer: {
                        type: "simple",
                        symbol: {
                            type: "simple-marker",
                            color: [255, 0, 0, 0.6],
                            size: 4,
                            outline: {
                                width: 0.5,
                                color: "white"
                            }
                        }
                    },
                    popupTemplate: {
                        title: "{CITY_NAME}",
                        content: "人口: {POP} <br> 国家: {CNTRY_NAME}"
                    }
                });
                
                populationLayer.id = "population-layer";
                map.add(populationLayer);
            }
            
            // 移除人口密度图层
            function removePopulationLayer() {
                const layer = map.findLayerById("population-layer");
                if (layer) {
                    map.remove(layer);
                }
            }
            
            // 添加天气图层
            function addWeatherLayer() {
                // 这里可以添加真实的天气图层URL
                // 由于没有真实的天气图层服务，我们创建一个示例图层
                const weatherLayer = new GraphicsLayer();
                weatherLayer.id = "weather-layer";
                
                // 添加一些示例天气点
                const weatherPoints = [
                    { x: 103.8343, y: 36.0611, weather: "晴", temp: "25°C" },
                    { x: 104.0, y: 36.2, weather: "多云", temp: "23°C" },
                    { x: 103.6, y: 35.9, weather: "小雨", temp: "20°C" }
                ];
                
                weatherPoints.forEach(point => {
                    const graphic = new Graphic({
                        geometry: new Point({ x: point.x, y: point.y }),
                        symbol: {
                            type: "text",
                            color: "white",
                            haloColor: "blue",
                            haloSize: "2px",
                            text: point.weather + " " + point.temp,
                            xoffset: 0,
                            yoffset: 0,
                            font: {
                                size: 12,
                                family: "sans-serif"
                            }
                        },
                        attributes: point
                    });
                    weatherLayer.add(graphic);
                });
                
                map.add(weatherLayer);
            }
            
            // 移除天气图层
            function removeWeatherLayer() {
                const layer = map.findLayerById("weather-layer");
                if (layer) {
                    map.remove(layer);
                }
            }
            
            // 打印地图
            function printMap() {
                const printWidget = new Print({
                    view: view,
                    printServiceUrl: "https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"
                });
                
                // 显示打印选项面板
                const panel = document.getElementById("print-panel");
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                    printWidget.container = "print-panel-container";
                    printWidget.startup();
                }
            }
            
            // 监听测量工具的变化
            view.watch("popup.visible", function(newValue) {
                if (!newValue && activeTool === "identify") {
                    // 当弹出窗口关闭时，如果识别工具仍然激活，不做任何操作
                }
            });
            
        });
        
        // 监听Enter键进行搜索
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("search-input").addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    searchLocation();
                }
            });
        });
    </script>
</head>

<body>
    <!-- 地图容器 -->
    <div id="viewDiv"></div>
    
    <!-- 加载动画 -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>地图加载中...</div>
    </div>
    
    <!-- 搜索框 -->
    <div class="search-container">
        <input type="text" id="search-input" placeholder="搜索地址、地点或坐标">
        <button id="search-button" onclick="searchLocation()">搜索</button>
    </div>
    
    <!-- 工具栏 -->
    <div class="toolbar">
        <div class="tool-button" id="distance-btn" title="距离测量" onclick="toggleTool('distance')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9.01 14H2v2h7.01v3L13 15l-3.99-4v3zm5.98-1v-3H22V8h-7.01V5L11 9l3.99 4z"/>
            </svg>
        </div>
        <div class="tool-button" id="area-btn" title="面积测量" onclick="toggleTool('area')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l-5.5 9h11z M12 22l5.5-9h-11z M3.5 9l5.5 9v-11z M20.5 9l-5.5 9v-11z"/>
            </svg>
        </div>
        <div class="tool-button" id="identify-btn" title="要素识别" onclick="toggleTool('identify')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </div>
        <div class="tool-button" id="draw-btn" title="绘图工具" onclick="toggleTool('draw')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
        </div>
        <div class="tool-button" id="layers-btn" title="图层管理" onclick="toggleTool('layers')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
            </svg>
        </div>
        <div class="tool-button" id="print-btn" title="打印地图" onclick="toggleTool('print')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
            </svg>
        </div>
    </div>
    
    <!-- 绘图面板 -->
    <div id="draw-panel" class="layer-panel" style="top: 80px; width: 220px;">
        <h3>绘图工具</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px;">
            <button onclick="startDrawing('point')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">点</button>
            <button onclick="startDrawing('polyline')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">线</button>
            <button onclick="startDrawing('polygon')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">面</button>
            <button onclick="startDrawing('rectangle')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">矩形</button>
            <button onclick="startDrawing('circle')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">圆形</button>
            <button onclick="startDrawing('text')" style="padding: 5px 10px; background-color: #0079c1; color: white; border: none; border-radius: 4px; cursor: pointer;">文本</button>
        </div>
        <button onclick="clearDrawings()" style="width: 100%; padding: 5px; background-color: #d9534f; color: white; border: none; border-radius: 4px; cursor: pointer;">清除所有绘图</button>
    </div>
    
    <!-- 图层面板 -->
    <div id="layer-panel" class="layer-panel">
        <h3>图层管理</h3>
        <div class="layer-item">
            <input type="checkbox" id="base-layer" checked disabled>
            <label for="base-layer">基础底图</label>
        </div>
        <div class="layer-item">
            <input type="checkbox" id="traffic-layer" onchange="toggleLayer('traffic')">
            <label for="traffic-layer">交通图层</label>
        </div>
        <div class="layer-item">
            <input type="checkbox" id="satellite-layer" onchange="toggleLayer('satellite')">
            <label for="satellite-layer">卫星图层</label>
        </div>
        <div class="layer-item">
            <input type="checkbox" id="terrain-layer" onchange="toggleLayer('terrain')">
            <label for="terrain-layer">地形图层</label>
        </div>
        <div class="layer-item">
            <input type="checkbox" id="population-layer" onchange="toggleLayer('population')">
            <label for="population-layer">人口密度图层</label>
        </div>
        <div class="layer-item">
            <input type="checkbox" id="weather-layer" onchange="toggleLayer('weather')">
            <label for="weather-layer">天气图层</label>
        </div>
    </div>
    
    <!-- 打印面板 -->
    <div id="print-panel" class="layer-panel" style="top: 80px; width: 300px;">
        <h3>打印地图</h3>
        <div id="print-panel-container"></div>
    </div>
    
    <!-- 坐标显示 -->
    <div id="coordinates" class="coordinates">
        经度: 0.000000<br>
        纬度: 0.000000
    </div>
    
    <!-- 测量结果显示 -->
    <div id="measurement-result" class="measurement-result" style="display: none;">
        选择工具开始测量
    </div>
</body>

</html>